<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Definitive Interactive Glassmorphic Icon System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;background-color:#1a1a1a;background-size:cover;background-attachment:fixed;background-position:center;overflow:hidden } 
        body.dark-mode{color:#fff;--preview-glow:rgba(255,255,255,.7);--slider-track:rgba(0,0,0,0.3);--control-border:rgba(255,255,255,0.1)}body.light-mode{color:#222;--preview-glow:rgba(0,0,0,.4);--slider-track:rgba(0,0,0,0.1);--control-border:rgba(0,0,0,0.1)}body.custom-mode{color:#fff;--preview-glow:rgba(12,235,235,.7);--slider-track:rgba(0,0,0,0.3);--control-border:rgba(12,235,235,0.2)}main{width:100vw;height:100vh;position:relative}
        .glass-icon{--size:var(--container-size,90px);--font-size:var(--ui-font-size,14px);--glyph-size:var(--ui-glyph-size,36px);width:var(--size);height:var(--size);background:0 0;position:absolute;z-index:1;cursor:grab;transition:transform .2s ease;display:flex;align-items:center;justify-content:center;user-select:none}.glass-icon:active{cursor:grabbing;z-index:10;transform:scale(.98);transition-duration:.1s}.glass-icon:hover{transform:translateY(-5px) scale(1.05)}.glass-icon-inner{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;transition:background-color .3s ease,box-shadow .3s ease,border-radius .3s ease,border-color .3s ease;backdrop-filter:var(--backdrop-filter);-webkit-backdrop-filter:var(--backdrop-filter);border:var(--border-size) solid var(--border-color);box-shadow:var(--inner-shadow)}.glass-icon-inner::before{content:'';position:absolute;left:0;top:0;width:100%;height:100%;background-image:radial-gradient(circle at var(--mouse-x) var(--mouse-y),rgba(255,255,255,.6),transparent 40%);opacity:0;transition:opacity .3s ease;z-index:2;border-radius:inherit}.glass-icon:hover .glass-icon-inner::before{opacity:1}#preview-icon{position:static;cursor:default}#preview-icon:active{transform:scale(1)}#preview-icon:hover{transform:translateY(0)}#preview-icon .glass-icon-inner{border:none!important;box-shadow:0 0 0 3px var(--preview-glow)!important}.glass-icon i,.glass-icon p{pointer-events:none}.glass-icon i{font-size:var(--glyph-size);margin-bottom:8px}.glass-icon p{margin:0;font-size:var(--font-size);font-weight:500;opacity:.8}
        #glass-tooltip{position:fixed;z-index:200;padding:8px 14px;font-size:.9em;font-weight:500;pointer-events:none;opacity:0;transform:translateY(10px) scale(.95);transition:opacity .2s ease,transform .2s ease,background-color .3s ease,border-color .3s ease,backdrop-filter .3s ease;box-shadow:0 4px 12px rgba(0,0,0,.2);border-radius:8px}#glass-tooltip.visible{opacity:1;transform:translateY(0) scale(1)}#glass-tooltip::after{content:'';position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;transition:border-top-color .3s ease}
        #theme-controls{position:fixed;z-index:99;cursor:grab;transition:transform .4s cubic-bezier(.16,1,.3,1),opacity .4s ease;opacity:0;transform:translateX(-150%);pointer-events:none}#theme-controls.visible{opacity:1;transform:translateX(0);pointer-events:auto}#theme-controls:active{cursor:grabbing;z-index:100}.theme-controls-inner{padding:15px 25px;border-radius:20px;width:300px;box-shadow:0 16px 40px rgba(0,0,0,.37);transition:background .5s ease,border .5s ease;backdrop-filter:blur(25px) saturate(180%);-webkit-backdrop-filter:blur(25px) saturate(180%)}.dark-mode .theme-controls-inner{background:rgba(30,30,30,.4);border:1px solid rgba(255,255,255,.1)}.light-mode .theme-controls-inner{background:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.5)}.custom-mode .theme-controls-inner{background:rgba(50,20,70,.4);border:1px solid rgba(12,235,235,.2)}
        #theme-controls h3 { margin: 0 0 10px; text-align: center; font-weight: 600; font-size: 1.2em; }
        #current-theme-name { font-weight: 400; font-size: 0.8em; text-transform: capitalize; opacity: 0.8;}
        #preview-box{display:flex;flex-direction:column;align-items:center;padding:10px 0 20px 0;gap:8px;position:relative}
        .panel-divider { height: 1px; width: 100%; background: var(--control-border); margin: 5px 0 0 0; }
        #preview-icon{position:static;cursor:default}#preview-icon:active{transform:scale(1)}#preview-icon:hover{transform:translateY(0)}.accordion-section summary{font-weight:600;cursor:pointer;list-style:none;display:flex;justify-content:space-between;align-items:center;padding:15px 0;font-size:1.1em}.accordion-section summary::-webkit-details-marker{display:none}.accordion-section .summary-title{display:flex;align-items:center;gap:8px}.accordion-section summary::after{content:'ï¼‹';font-size:1.1em;line-height:1;transition:transform .2s ease;font-weight:400;opacity:.8}.accordion-section[open] summary::after{content:"\00D7";transform:none}.accordion-content{padding:0 5px 15px 5px;overflow:hidden}.control-group{margin-top:15px}.control-group label{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:.9em}.slider-value{font-weight:500;font-family:monospace}
        .summary-title .grip-icon { font-size: 1.2em; opacity: 0.5; margin-right: 5px; }
        #radius-summary{cursor:pointer}#radius-sliders-container{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding-top:20px;max-height:0;opacity:0;transform:translateY(-10px);transition:max-height .3s ease,opacity .3s ease,transform .3s ease,padding-top .3s ease;overflow:hidden}#radius-sliders-container.visible{max-height:120px;opacity:1;transform:translateY(0)}.radius-slider-wrapper{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:8px}#radius-sliders-container input[type=range]{writing-mode:vertical-lr;direction:rtl;width:8px;height:80px}.slider-value-individual{font-family:monospace;font-size:.8em}.native-color-picker{margin-top:15px}.native-color-picker .color-input-wrapper{display:flex;align-items:center;gap:10px;background:var(--slider-track);padding:5px;border-radius:6px}.native-color-picker label{margin-bottom:5px; font-weight:500;}.native-color-picker input[type=color]{width:40px;height:30px;border:none;padding:0;background:0 0;border-radius:4px;cursor:pointer}.native-color-picker input[type=range]{flex-grow:1}
        .button-group{display:flex;gap:8px;margin-top:20px}.control-button{flex-grow:1;padding:10px;border-radius:8px;border:1px solid var(--control-border);font-size:.9em;font-weight:600;cursor:pointer;transition:all .2s ease;background-color:rgba(0,0,0,0.1)}.dark-mode .control-button:hover{background-color:rgba(255,255,255,.1)}.light-mode .control-button:hover,.custom-mode .control-button:hover{background-color:rgba(0,0,0,.1)}
        input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:8px;background:var(--slider-track);border-radius:4px;outline:0;background-image:linear-gradient(#3b82f6,#3b82f6);background-size:0 100%;background-repeat:no-repeat}
        input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;background:#fff;cursor:pointer;border-radius:50%;border:2px solid #3b82f6;}
    </style>
    <script src="dynamic-background.js" defer></script>
    <script src="demo.js" defer></script>
</head>
<body class="dark-mode">
    <main id="main-container"></main>

<script>
    class Draggable {
        constructor(element) { if (!element) return; this.element = element; this.offsetX = 0; this.offsetY = 0; this._onMouseMove = this._onMouseMove.bind(this); this._onMouseUp = this._onMouseUp.bind(this); this.element.addEventListener('mousedown', this._onMouseDown.bind(this)); }
        _onMouseDown(e) { if (e.target.closest('input, button, summary, a')) return; e.preventDefault(); this.offsetX = e.clientX - this.element.offsetLeft; this.offsetY = e.clientY - this.element.offsetTop; document.addEventListener('mousemove', this._onMouseMove); document.addEventListener('mouseup', this._onMouseUp); }
        _onMouseMove(e) { e.preventDefault(); this.element.style.left = `${e.clientX - this.offsetX}px`; this.element.style.top = `${e.clientY - this.offsetY}px`; }
        _onMouseUp() { document.removeEventListener('mousemove', this._onMouseMove); document.removeEventListener('mouseup', this._onMouseUp); }
    }

    class GlassmorphicThemeManager {
        constructor() {
            this.currentThemeMode = 'dark';
            this.iconClickMap = new Map();
            this.tooltipTimeout = null;
            this.liveIcons = [];
            this._createControlsHTML();
            this._initDOM();
            this._setupEventListeners();
            this.initializeTheme();
        }

        toggleControls() {
            this.controlsPanel.classList.toggle('visible');
        }

        showControls() {
            this.controlsPanel.classList.add('visible');
            
            // Create preview icon dynamically when controls are shown
            this._createPreviewIcon();
        }

        hideControls() {
            this.controlsPanel.classList.remove('visible');
        }

        isControlsVisible() {
            return this.controlsPanel.classList.contains('visible');
        }

        createIcon(options) {
            const { container, iconClass, text, onClick, isPreview = false, isDraggable = true } = options;
            const targetContainer = document.querySelector(container);
            if (!targetContainer) { console.error(`Container not found for icon: ${container}`); return null; }
            const el = document.createElement('div');
            el.className = 'glass-icon';
            if (isPreview) { el.id = 'preview-icon'; el.style.position = 'static'; el.style.cursor = 'default'; }
            el.innerHTML = `<div class="glass-icon-inner"><i class="fas ${iconClass}"></i><p>${text}</p></div>`;
            targetContainer.appendChild(el);

            if (onClick) { this.iconClickMap.set(el, onClick); }
            if (isDraggable) { new Draggable(el); }
            if (!isPreview) { this.liveIcons.push(el); }

            this.applyTheme(this.getThemeFromControls() || this.loadTheme());
            return el;
        }

        _createControlsHTML() {
            const controlsContainer = document.createElement('div');
            controlsContainer.id = 'theme-controls';
            controlsContainer.innerHTML = `<div class="theme-controls-inner"><h3>Theme: <span id="current-theme-name"></span></h3><div id="preview-box"></div><div class="panel-divider"></div><details class="accordion-section" open><summary class="summary-title">Shape & Border</summary><div class="accordion-content"><div class="control-group"><label>Container Size <span id="container-size-value" class="slider-value"></span></label><input type="range" id="container-size" min="50" max="150"></div><div class="control-group"><label id="radius-summary"><i class="fas fa-grip-vertical grip-icon"></i>Corner Radius <span id="radius-value" class="slider-value"></span></label><div id="radius-sliders-container"><div class="radius-slider-wrapper"><input type="range" id="br-tl" min="0" max="75"><span class="slider-value-individual" id="br-tl-value"></span></div><div class="radius-slider-wrapper"><input type="range" id="br-tr" min="0" max="75"><span class="slider-value-individual" id="br-tr-value"></span></div><div class="radius-slider-wrapper"><input type="range" id="br-bl" min="0" max="75"><span class="slider-value-individual" id="br-bl-value"></span></div><div class="radius-slider-wrapper"><input type="range" id="br-br" min="0" max="75"><span class="slider-value-individual" id="br-br-value"></span></div></div></div><div class="control-group"><label>Border Size <span id="border-size-value" class="slider-value"></span></label><input type="range" id="border-size" min="0" max="10" step="0.1"></div><div class="native-color-picker"><label>Border Tint</label><div class="color-input-wrapper"><input type="color" id="border-tint-color"><input type="range" id="border-tint-alpha" min="0" max="1" step="0.01"></div></div></div></details><details class="accordion-section" open><summary class="summary-title">Glass & Shine</summary><div class="accordion-content"><div class="native-color-picker"><label>Glass Tint</label><div class="color-input-wrapper"><input type="color" id="glass-tint-color"><input type="range" id="glass-tint-alpha" min="0" max="1" step="0.01"><span class="slider-value" id="opacity-value"></span></div></div><div class="control-group"><label>Blur <span id="blur-value" class="slider-value"></span></label><input type="range" id="blur-amount" min="0" max="40"></div><div class="control-group"><label>Saturate <span id="saturate-value" class="slider-value"></span></label><input type="range" id="saturate-amount" min="100" max="250"></div></div></details><details class="accordion-section" open><summary class="summary-title">Text & Glyph</summary><div class="accordion-content"><div class="control-group"><label>Glyph Size <span id="glyph-size-value" class="slider-value"></span></label><input type="range" id="glyph-size" min="12" max="60"></div><div class="control-group"><label>Font Size <span id="font-size-value" class="slider-value"></span></label><input type="range" id="font-size" min="8" max="24"></div><div class="native-color-picker"><label>Icon/Text Tint</label><div class="color-input-wrapper"><input type="color" id="icon-tint-color"><input type="range" id="icon-tint-alpha" min="0" max="1" step="0.01"></div></div></div></details><div class="button-group"><button id="theme-switcher" class="control-button"></button><button id="save-theme" class="control-button">Save</button><button id="reset-theme" class="control-button">Reset</button></div></div>`;
            document.body.appendChild(controlsContainer);
        }

        _initDOM() {
            this.controlsPanel = document.getElementById('theme-controls');
            this.body = document.body;
            this.radiusSummary = document.getElementById('radius-summary');
            this.radiusSlidersContainer = document.getElementById('radius-sliders-container');
            this.themeSwitcher = document.getElementById('theme-switcher');
            this.controls = {
                containerSize: document.getElementById('container-size'), glyphSize: document.getElementById('glyph-size'), fontSize: document.getElementById('font-size'), borderSize: document.getElementById('border-size'),
                br_tl: document.getElementById('br-tl'), br_tr: document.getElementById('br-tr'), br_bl: document.getElementById('br-bl'), br_br: document.getElementById('br-br'),
                blur: document.getElementById('blur-amount'), saturate: document.getElementById('saturate-amount'),
                glassTintColor: document.getElementById('glass-tint-color'), glassTintAlpha: document.getElementById('glass-tint-alpha'),
                iconTintColor: document.getElementById('icon-tint-color'), iconTintAlpha: document.getElementById('icon-tint-alpha'),
                borderColor: document.getElementById('border-tint-color'), borderAlpha: document.getElementById('border-tint-alpha'),
            };
            this.values = {
                containerSize: document.getElementById('container-size-value'), glyphSize: document.getElementById('glyph-size-value'), fontSize: document.getElementById('font-size-value'), borderSize: document.getElementById('border-size-value'),
                radius: document.getElementById('radius-value'), opacity: document.getElementById('opacity-value'), blur: document.getElementById('blur-value'), saturate: document.getElementById('saturate-value'),
                br_tl: document.getElementById('br-tl-value'), br_tr: document.getElementById('br-tr-value'), br_bl: document.getElementById('br-bl-value'), br_br: document.getElementById('br-br-value'),
                themeName: document.getElementById('current-theme-name'),
            };

            const tooltip = document.createElement('div');
            tooltip.id = 'glass-tooltip';
            document.getElementById('main-container').appendChild(tooltip);
            this.tooltip = tooltip;

            new Draggable(this.controlsPanel);
            this.controlsPanel.style.left = `${window.innerWidth - 350}px`;
            this.controlsPanel.style.top = '20px';
        }

        _createPreviewIcon() {
            // Remove existing preview icon if it exists
            const existingPreview = document.getElementById('preview-icon');
            if (existingPreview) {
                existingPreview.remove();
            }
            
            // Create new preview icon using the same method as regular icons
            this.previewIcon = this.createIcon({
                container: '#preview-box', 
                iconClass: 'fa-star', 
                text: 'Preview', 
                isPreview: true, 
                isDraggable: false
            });
        }

        _setupEventListeners() {
            this.controlsPanel.addEventListener('input', e => { this.applyTheme(this.getThemeFromControls()); if (e.target.type === 'range') { this._updateSliderFill(e.target); } });
            this.radiusSummary.addEventListener('click', e => { e.preventDefault(); this.radiusSlidersContainer.classList.toggle('visible'); });
            this.themeSwitcher.addEventListener('click', () => { if (typeof setRandomGradientBackground === 'function') setRandomGradientBackground(); this.toggleTheme(); });
            document.getElementById('save-theme').addEventListener('click', () => this.saveTheme(this.getThemeFromControls()));
            document.getElementById('reset-theme').addEventListener('click', this.resetCurrentTheme);
            document.body.addEventListener('click', e => { const icon = e.target.closest('.glass-icon:not(#preview-icon)'); if (icon && this.iconClickMap.has(icon)) { this.iconClickMap.get(icon)(); } });
            document.body.addEventListener('mousemove', e => { document.querySelectorAll('.glass-icon:hover').forEach(icon => { const rect = icon.getBoundingClientRect(); icon.style.setProperty('--mouse-x', `${e.clientX - rect.left}px`); icon.style.setProperty('--mouse-y', `${e.clientY - rect.top}px`); }); });
            document.body.addEventListener('mouseover', e => {
                const icon = e.target.closest('.glass-icon');
                if (!icon || icon.id === 'settings-toggle') return;
                clearTimeout(this.tooltipTimeout);
                this.tooltipTimeout = setTimeout(() => {
                    const text = icon.querySelector('p')?.textContent;
                    if(text) {
                        this.tooltip.textContent = text;
                        const iconRect = icon.getBoundingClientRect();
                        this.tooltip.style.left = `${iconRect.left + iconRect.width / 2 - this.tooltip.offsetWidth / 2}px`;
                        this.tooltip.style.top = `${iconRect.top - this.tooltip.offsetHeight - 12}px`;
                        this.tooltip.classList.add('visible');
                    }
                }, 250);
            }, true);
            document.body.addEventListener('mouseout', e => { const icon = e.target.closest('.glass-icon'); if (icon) { clearTimeout(this.tooltipTimeout); this.tooltip.classList.remove('visible'); } }, true);
        }

        _rgbaToComponents(rgba) { if (!rgba || typeof rgba !== 'string') return { hex: '#ffffff', alpha: 1 }; const match = rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/); if (!match) return { hex: '#ffffff', alpha: 1 }; const toHex = c => ('0' + parseInt(c).toString(16)).slice(-2); return { hex: `#${toHex(match[1])}${toHex(match[2])}${toHex(match[3])}`, alpha: match[4] !== undefined ? parseFloat(match[4]) : 1 }; }
        _hexToRgb(hex) { if (!hex || typeof hex !== 'string' || hex.length < 4) return '255, 255, 255'; const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16); return `${r}, ${g}, ${b}`; }
        _updateSliderFill(slider) { const min = slider.min || 0; const max = slider.max || 100; const val = slider.value; slider.style.backgroundSize = `${((val - min) * 100) / (max - min)}% 100%`; }
        
        lightThemeDefaults = { containerSize: "80", glyphSize: "32", fontSize: "12", borderSize: "1.5", br_tl: "24", br_tr: "24", br_bl: "24", br_br: "24", blur: "8", saturate: "120", glassTint: "rgba(255, 255, 255, 0.4)", iconTint: "rgba(26, 26, 26, 1)", borderColor: "rgba(0,0,0,0.15)" };
        darkThemeDefaults = { containerSize: "90", glyphSize: "36", fontSize: "14", borderSize: "2", br_tl: "28", br_tr: "28", br_bl: "28", br_br: "28", blur: "12", saturate: "150", glassTint: "rgba(34, 34, 34, 0.7)", iconTint: "rgba(255, 255, 255, 1)", borderColor: "rgba(255,255,255,0.2)" };
        customThemeDefaults = { containerSize: "85", glyphSize: "40", fontSize: "10", borderSize: "0", br_tl: "50", br_tr: "50", br_bl: "50", br_br: "50", blur: "4", saturate: "180", glassTint: "rgba(80, 20, 120, 0.5)", iconTint: "rgba(12, 235, 235, 1)", borderColor: "rgba(12,235,235,0.2)" };
        _getDefaultsForMode(mode) { if (mode === 'light') return this.lightThemeDefaults; if (mode === 'custom') return this.customThemeDefaults; return this.darkThemeDefaults; }
        
        async initializeTheme() {
            const savedPref = localStorage.getItem("userThemePreference"); const osPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches; this.currentThemeMode = savedPref || (osPrefersDark ? "dark" : "light");
            window.themeManager = this;
            this.applyTheme(this.loadTheme());
            
            // Add global keyboard shortcuts for easy access
            this._setupGlobalShortcuts();
        }

        _setupGlobalShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+Shift+T to toggle theme controls
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    this.toggleControls();
                }
                // Ctrl+Shift+H to hide controls
                if (e.ctrlKey && e.shiftKey && e.key === 'H') {
                    e.preventDefault();
                    this.hideControls();
                }
                // Ctrl+Shift+S to show controls
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    this.showControls();
                }
                // Escape to hide controls
                if (e.key === 'Escape' && this.isControlsVisible()) {
                    e.preventDefault();
                    this.hideControls();
                }
            });

            // Double-click anywhere on background to toggle controls
            document.addEventListener('dblclick', (e) => {
                if (e.target === document.body || e.target.id === 'main-container') {
                    this.toggleControls();
                }
            });
        }
        
        toggleTheme() {
            const currentShapeTheme = this.getThemeFromControls(); const themeCycle = { "dark": "light", "light": "custom", "custom": "dark" }; this.currentThemeMode = themeCycle[this.currentThemeMode]; localStorage.setItem("userThemePreference", this.currentThemeMode); const nextColorDefaults = this._getDefaultsForMode(this.currentThemeMode); const newTheme = { ...currentShapeTheme, glassTint: nextColorDefaults.glassTint, iconTint: nextColorDefaults.iconTint, borderColor: nextColorDefaults.borderColor, blur: nextColorDefaults.blur, saturate: nextColorDefaults.saturate }; this.applyTheme(newTheme);
        }
        loadTheme() { const savedSettings = localStorage.getItem(`widgetGlassTheme_${this.currentThemeMode}`); const defaults = this._getDefaultsForMode(this.currentThemeMode); return savedSettings ? { ...defaults, ...JSON.parse(savedSettings) } : defaults; }
        saveTheme(themeData) { localStorage.setItem(`widgetGlassTheme_${this.currentThemeMode}`, JSON.stringify(themeData)); }
        resetCurrentTheme = () => { const defaults = this._getDefaultsForMode(this.currentThemeMode); this.applyTheme(defaults); localStorage.removeItem(`widgetGlassTheme_${this.currentThemeMode}`); }

        applyTheme(themeData) {
            this.body.className = `${this.currentThemeMode}-mode`; this.values.themeName.textContent = this.currentThemeMode; const nextThemeName = { "dark": "Light", "light": "Custom", "custom": "Dark" }[this.currentThemeMode]; this.themeSwitcher.textContent = `Switch to ${nextThemeName}`;
            this.body.style.setProperty('--container-size', `${themeData.containerSize}px`); this.body.style.setProperty('--ui-glyph-size', `${themeData.glyphSize}px`); this.body.style.setProperty('--ui-font-size', `${themeData.fontSize}px`);
            
            const backdropFilter = `blur(${themeData.blur}px) saturate(${themeData.saturate}%)`;
            const innerBorderStyle = `inset 0 0 0 ${themeData.borderSize}px ${themeData.borderColor}`;
            
            document.querySelectorAll(".glass-icon").forEach(icon => {
                const inner = icon.querySelector(".glass-icon-inner");
                if (inner) {
                    inner.style.borderRadius = `${themeData.br_tl}px ${themeData.br_tr}px ${themeData.br_br}px ${themeData.br_bl}px`;
                    inner.style.backgroundColor = themeData.glassTint;
                    inner.style.setProperty("--backdrop-filter", backdropFilter);
                    
                    if (icon.id === "preview-icon") { 
                        // Preview icon gets glow instead of border
                        inner.style.border = 'none';
                        inner.style.boxShadow = `0 0 0 3px var(--preview-glow)`;
                    } else {
                        // Regular icons get the border
                        inner.style.border = `${themeData.borderSize}px solid ${themeData.borderColor}`;
                        inner.style.boxShadow = innerBorderStyle;
                    }
                }
                icon.style.color = themeData.iconTint;
            });
            
            if (this.tooltip) {
                this.tooltip.style.backgroundColor = themeData.glassTint; 
                this.tooltip.style.backdropFilter = this.tooltip.style.webkitBackdropFilter = backdropFilter; 
                this.tooltip.style.border = `${themeData.borderSize}px solid ${themeData.borderColor}`; 
                this.tooltip.style.color = themeData.iconTint;
                this._updateTooltipTailStyle(themeData.borderColor);
            }
            
            for (const key in this.controls) { if (themeData[key] !== undefined) { this.controls[key].value = themeData[key]; } }
            
            const glassColor = this._rgbaToComponents(themeData.glassTint); this.controls.glassTintColor.value = glassColor.hex; this.controls.glassTintAlpha.value = glassColor.alpha;
            const iconColor = this._rgbaToComponents(themeData.iconTint); this.controls.iconTintColor.value = iconColor.hex; this.controls.iconTintAlpha.value = iconColor.alpha;
            const borderColorComp = this._rgbaToComponents(themeData.borderColor); this.controls.borderColor.value = borderColorComp.hex; this.controls.borderAlpha.value = borderColorComp.alpha;
            
            this.values.containerSize.textContent = `${themeData.containerSize}px`; this.values.glyphSize.textContent = `${themeData.glyphSize}px`; this.values.fontSize.textContent = `${themeData.fontSize}px`;
            this.values.borderSize.textContent = `${parseFloat(themeData.borderSize).toFixed(1)}px`; this.values.opacity.textContent = `${Math.round(this.controls.glassTintAlpha.value * 100)}%`;
            this.values.blur.textContent = `${themeData.blur}px`; this.values.saturate.textContent = `${themeData.saturate}%`;
            this.values.radius.textContent = `T:${themeData.br_tl},${themeData.br_tr} B:${themeData.br_bl},${themeData.br_br}`;
            this.values.br_tl.textContent = `${themeData.br_tl}px`; this.values.br_tr.textContent = `${themeData.br_tr}px`; this.values.br_bl.textContent = `${themeData.br_bl}px`; this.values.br_br.textContent = `${themeData.br_br}px`;

            document.querySelectorAll('input[type="range"]').forEach(this._updateSliderFill.bind(this));
            
            // Refresh preview icon if controls are visible
            if (this.controlsPanel.classList.contains('visible')) {
                this._createPreviewIcon();
            }
        }
        
        _updateTooltipTailStyle(borderColor) {
            let styleEl = document.getElementById('tooltip-style'); if (!styleEl) { styleEl = document.createElement('style'); styleEl.id = 'tooltip-style'; document.head.appendChild(styleEl); }
            styleEl.textContent = `#glass-tooltip::after { border-top-color: ${borderColor}; }`;
        }
        
        getThemeFromControls() {
            const theme = {};
            for (const key in this.controls) { if (!key.includes('Tint') && !key.includes('Alpha') && key !== 'borderColor') { theme[key] = this.controls[key].value; } }
            const glassRgb = this._hexToRgb(this.controls.glassTintColor.value); theme.glassTint = `rgba(${glassRgb}, ${this.controls.glassTintAlpha.value})`;
            const iconRgb = this._hexToRgb(this.controls.iconTintColor.value); theme.iconTint = `rgba(${iconRgb}, ${this.controls.iconTintAlpha.value})`;
            const borderRgb = this._hexToRgb(this.controls.borderColor.value); theme.borderColor = `rgba(${borderRgb}, ${this.controls.borderAlpha.value})`;
            return theme;
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => { window.themeManager = new GlassmorphicThemeManager(); });
</script>
</body>
</html>